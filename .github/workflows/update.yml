name: update
on:
  schedule:
    - cron: "0 0 * * *"
  workflow_dispatch:
jobs:

  main:
    name: Push updates
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: Homebrew/actions/setup-homebrew@master
      - run: brew install ddev/ddev/ddev >/dev/null
      - uses: actions/checkout@v4
      - name: 'Run updates and commit'
        run: |
          ./update.sh
          if [[ `git status --porcelain` ]]; then
            git config --global user.name "Automatic updates"
            git config --global user.email "677879+hanoii@users.noreply.github.com"
            git add .
            git commit -m "feat: update.sh updates (GA)"
            git push
            gh workflow run tests
          fi

  keepalive:
    name: Keepalive Workflow
    runs-on: ubuntu-latest
    permissions:
      actions: write
    steps:
      - uses: actions/checkout@v4
      - uses: gautamkrishnar/keepalive-workflow@v2
